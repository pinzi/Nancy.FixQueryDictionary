name: GitHub Actions
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "è¯¥ä½œä¸šç”±${{github.event_name}}äº‹ä»¶è‡ªåŠ¨è§¦å‘"
      - run: echo "æ­¤ä½œä¸šç°åœ¨æ­£åœ¨GitHubæ‰˜ç®¡çš„${{runner.os}}æœåŠ¡å™¨ä¸Šè¿è¡Œ"
      - run: echo "åˆ†æ”¯çš„åç§°æ˜¯${{github.ref}}ï¼Œå­˜å‚¨åº“æ˜¯${{github.repository}}"
      - name: ç­¾å‡ºå­˜å‚¨åº“ä»£ç 
        uses: actions/checkout@v2
      - run: echo "${{github.repository}}å­˜å‚¨åº“å·²å…‹éš†åˆ°è¿è¡Œç¨‹åº"
      - run: echo "ğŸ–¥å·¥ä½œæµç°åœ¨å¯ä»¥åœ¨è¿è¡Œç¨‹åºä¸Šæµ‹è¯•ä»£ç äº†"
      - name: åˆ—å‡ºå­˜å‚¨åº“ä¸­çš„æ–‡ä»¶
        run: |
          ls ${{ github.workspace }}
      - name: åˆ—å‡ºReleaseå‘å¸ƒçš„æ–‡ä»¶
        run: |
          ls NugetPublish/Release
      - name: å®‰è£…nuget 
        uses: nuget/setup-nuget@v1
        with:        
            nuget-version: '5.x'
      - name: æ‰“åŒ…nuget package
        run: |
             nuget pack NugetPublish/Release/Nancy.FixQueryDictionary.nuspec -OutputDirectory NugetPublish/Release/
      - name: æ˜¾ç¤ºæ‰“åŒ…å®Œæˆåçš„nupkgæ–‡ä»¶
        run: |
          ls NugetPublish/Release
      - name: æ·»åŠ githubæº
        run: |
            dotnet nuget add source --username pinzi --password ${{ secrets.nuget_ApiKey }} --store-password-in-clear-text --name github "https://nuget.pkg.github.com/OWNER/index.json"
      - name: å‘å¸ƒåˆ°github
        run: |
            dotnet nuget push NugetPublish/Release/*.nupkg  --api-key ${{ secrets.GITHUB_TOKEN }} --source "github" --skip-duplicate
      - name: å‘å¸ƒåˆ°NuGet
        uses: brandedoutcast/publish-nuget@v2.5.5
        with:
          # æ‰“åŒ…æ–‡ä»¶è·¯å¾„
          PROJECT_FILE_PATH: NugetPublish/Release/Nancy.FixQueryDictionary.nuspec
          # nuget package åç§°
          PACKAGE_NAME: Nancy.FixQueryDictionary
          # åŒ¹é…nuget packageç‰ˆæœ¬å·æ­£åˆ™è¡¨è¾¾å¼
          VERSION_REGEX: ^\s*<version>(.*)<\/version>\s*$
          # nuget package å‘å¸ƒapikey
          NUGET_KEY: ${{secrets.NUGET_API_KEY}}
      - run: echo "æ­¤ä½œä¸šçš„çŠ¶æ€ä¸º${{job.status}}"
